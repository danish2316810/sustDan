require('axios').interceptors.response.use(
    response => response,
    axError => {
        const { url, method } = axError.config ?? {};
        const { code, response } = axError;
        const { status, data } = response ?? {};
        const reason = data?.error /* RFC 6749 */ ?? axError.message;
        const prefix = (url && method
                ? `${method.toUpperCase()} ${url} `
                : '') +
            'failed';
        const message = prefix +
            (status || code ? ':' : '') +
            (status ? ` ${status}` : '') +
            (code ? ` ${code}` : '') +
            `. ${reason}.`;
        const error = new Error(message);
        error.status = status;
        const cds = require('@sap/cds');
        if (cds.debug('req|mtx')) {
            error.cause = axError;
        }
        if (data) {
            cds.log('req').error(`Details on error '${prefix}': ` +
                (data.error_description /* RFC 6749 */ || require('util').inspect(data)) + `'`);
        }
        return Promise.reject(error);
    }
);
